encapsulate k selection in one function
make the pipeline? parts of pipeline? a class?
